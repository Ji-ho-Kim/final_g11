<!DOCTYPE html>
<html>
    <head>
        <title>Buttons</title>
        <meta charset="UTF-8">
        <meta name="viewport" ontent="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" />
        <script src="js/jquery-3.5.1.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.14.3/xlsx.full.min.js"></script>
        <style>
            * { font-family: 'Nanum Pen Script', cursive; }
            table {
                margin: 0 auto;
                text-align: center;
                border-collapse: collapse;
                border: 1px solid gainsboro;
            }
            tr {
                background: whitesmoke;
            }
            th, td {
                padding: 10px 30px;
            }
            th {
                border-bottom: 1px solid whitesmoke;
            }
            tbody {
                background: whitesmoke;
            }
        </style>
    </head>
  
    <body>
        <div class="container">
            <div class="col-md-auto text-center mb-2 mt-2">
                <hr>
                <input type="file" id="excelFile" onchange="excelExport(event)"/>
                <input type="text" id="mykeyword" placeholder="유형을 입력하세요">
                <br>
                <hr>
                <div id="displayExcelHtml"></div>
            </div>
        </div>

    <script>
        $(document).ready(function() {
            $("#mykeyword").on("keyup", function() {
                var value = $(this).val().toLowerCase();
                $("table > tbody > tr").hide();
                var temp = $("table > tbody > tr > td:nth-child(5n+4):contains('" + value + "')");
                $(temp).parent().show();
            });
        });
        $(document).ready(function() {
            var name = $('h1').find('span.textCity');
            $("table > tbody > tr").hide();
            var temp = $("table > tbody > tr > td:nth-child(5n+1):contains('" + name + "')");
            $(temp).parent().show();
        });
        $.ajax({
            url: 'csv_data.csv',
            dataType: 'text',
        }).done(Table);
        function excelExport(event){
            excelExportCommon(event, handleExcelDataAll);
        }
        function excelExportCommon(event, callback){
            var input = event.target;
            var reader = new FileReader();
            reader.onload = function() {
                var fileData = reader.result;
                var wb = XLSX.read(fileData, {type : 'binary'});
                var sheetNameList = wb.SheetNames;
                var firstSheetName = sheetNameList[0];
                var firstSheet = wb.Sheets[firstSheetName];
                callback(firstSheet);
            };
            reader.readAsBinaryString(input.files[0]);
        }
        function handleExcelDataAll(sheet){
            handleExcelDataHtml(sheet);
        }
        function handleExcelDataHtml(sheet){
            $("#displayExcelHtml").html(XLSX.utils.sheet_to_html(sheet));
        }
        function get_header_row(sheet) {
            var headers = [];
            var range = XLSX.utils.decode_range(sheet['!ref']);
            var C, R = range.s.r;
            for(C = range.s.c; C <= range.e.c; ++C) {
                var cell = sheet[XLSX.utils.encode_cell({c:C, r:R})]
                var hdr = "UNKNOWN " + C;
                if(cell && cell.t) hdr = XLSX.utils.format_cell(cell);
                    headers.push(hdr);
            }
            return headers;
        }
        function Table(data) {
            var allRows = data.split(/\r?\n|\r/);
            var table = document.createElement("table");
            table.className = "myTable";
            for (var singleRow = 0; singleRow < allRows.length; singleRow++) {
                if (singleRow === 0) {
                    var thead = document.createElement("thead");
                    var tr = document.createElement('tr');
                    table.appendChild(thead);
                    thead.appendChild(tr);
                } else {
                    var tr = document.createElement('tr');
                    thead.appendChild(tr);
                }
                var rowCells = allRows[singleRow].split(',');
                for (var rowCell = 0; rowCell < rowCells.length; rowCell++) {
                    if (singleRow === 0) {
                        var th = document.createElement("th");
                        th.innerHTML = rowCells[rowCell];
                        tr.appendChild(th);
                    } else {
                        var td = document.createElement("td");
                        td.innerHTML = rowCells[rowCell];
                        tr.appendChild(td);
                    }
                }
                if (singleRow === 0) {
                    var tbody = document.createElement("tbody");
                    table.className = "myTable_tbody";
                    table.appendChild(tbody);
                }
            }
            document.body.appendChild(table);
        }
    </script>
    </body>
</html>